<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Convict Conditioning Rep Player
      ãƒ—ãƒªã‚ºãƒŠãƒ¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆé–“éš”ã‚’éŸ³å£°ã§ç®¡ç†
    </title>
    <style>
      /* pè¦ç´ ã‚’å¤§ãããƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’è¨­å®š */
      p {
        font-size: 72px; /* é©åˆ‡ãªãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã«å¤‰æ›´ */
        text-align: center; /* ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸­å¤®ã«é…ç½® */
      }
      input {
        text-align: center; /* ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸­å¤®ã«é…ç½® */
      }
      form {
        text-align: center; /* ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸­å¤®ã«é…ç½® */
      }
      footer {
        background-color: #333; /* ãƒ•ãƒƒã‚¿ãƒ¼ã®èƒŒæ™¯è‰² */
        text-align: center; /* ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸­å¤®ã«é…ç½® */
        padding: 10px 0; /* ä¸Šä¸‹ã®ä½™ç™½ */
      }
      /* ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      body {
        background-color: white;
        color: black;
      }
      /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      @media (prefers-color-scheme: dark) {
        body {
          background-color: black;
          color: white;
        }
      }
    </style>
  </head>
  <body>
    <form id="playbackForm">
      <label for="playbackCount">Number of Rep:</label>
      <input type="number" id="playbackCount" min="1" value="50" />
      <p><span id="playCount">0</span></p>
      <button type="submit">START</button>
    </form>
    <p><span id="finish"> </span></p>

    <audio id="audioPlayer" controls hidden>
      <source src="data/cadence.mp3" type="audio/mp3" />
    </audio>
    <footer>
      &copy; 2023
      ãƒ—ãƒªã‚ºãƒŠãƒ¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆé–“éš”ã‚’éŸ³å£°ã§ç®¡ç†ã§ãã‚‹WEBã‚¢ãƒ—ãƒªã§ã™ã€‚
      <br />
      2ç§’â†’1ç§’â†’2ç§’ã®éŸ³æ¥½ãŒæŒ‡å®šå›æ•°å†ç”Ÿã•ã‚Œã¾ã™ã€‚
      <br />
      æŒ‡å®šå›æ•°å†ç”Ÿå¾Œã¯ã€æ­“å£°ãŒæµã‚Œã€çµµæ–‡å­—ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
      <br />
      ä½œæˆè€…: https://shunyaueta.com/
    </footer>
    <script>
      const playbackForm = document.getElementById("playbackForm");
      const playbackCountInput = document.getElementById("playbackCount");
      const audioPlayer = document.getElementById("audioPlayer");
      const playCountElement = document.getElementById("playCount");
      const finishElement = document.getElementById("finish");

      // ãƒ•ã‚©ãƒ¼ãƒ ãŒé€ä¿¡ã•ã‚ŒãŸã¨ãã®å‡¦ç†
      playbackForm.addEventListener("submit", function (e) {
        e.preventDefault();

        const playbackCount = parseInt(playbackCountInput.value);

        if (isNaN(playbackCount) || playbackCount < 1) {
          alert("å†ç”Ÿå›æ•°ã¯1ä»¥ä¸Šã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
          return;
        }

        playAudio(playbackCount);
      });
      let playCount = 0;

      // éŸ³å£°ã‚’å†ç”Ÿã™ã‚‹é–¢æ•°
      function playAudio(playbackCount) {
        const audioPromise = audioPlayer.play();
        if (audioPromise !== undefined) {
          audioPromise
            .then(() => {
              // éŸ³å£°å†ç”Ÿå®Œäº†æ™‚ã®å‡¦ç†
              let remainingCount = playbackCount - 1;
              audioPlayer.addEventListener("ended", function playNext() {
                if (remainingCount > 0) {
                  audioPlayer.play();
                  remainingCount--;
                  playCount++;
                  playCountElement.textContent = playCount;
                } else {
                  audioPlayer.removeEventListener("ended", playNext);
                  playCount++;
                  playCountElement.textContent = playCount;
                  finishElement.textContent = "ğŸ‰ğŸ’ªğŸ‰";
                  audioPlayer.src = "data/applause.mp3";
                  audioPlayer.play();
                }
              });
            })
            .catch((error) => {
              console.error("éŸ³å£°å†ç”Ÿä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
            });
        }
      }
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/pico.min.css" />
    <title>
      Convict Conditioning Sound Timer -
      ãƒ—ãƒªã‚ºãƒŠãƒ¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°éŸ³å£°ã‚¿ã‚¤ãƒãƒ¼ã‚¢ãƒ—ãƒª
    </title>
    <style>
      p {
        font-size: 72px;
        text-align: center;
      }
      input {
        text-align: center;
      }
      form {
        text-align: center;
      }
    </style>
  </head>
  <body>
    <main class="container">
      <form id="playbackForm">
        <label for="playbackCount">Number of Rep:</label>
        <input type="number" id="playbackCount" min="1" value="50" />
        <p><span id="playCount">0</span></p>
        <button type="submit">START</button>
      </form>
      <p><span id="finish"> </span></p>

      <audio id="audioPlayer" controls hidden>
        <source src="data/cadence.mp3" type="audio/mp3" />
      </audio>
      <footer>
        &copy; 2023
        <a href="https://amzn.to/3qZzihG">ãƒ—ãƒªã‚ºãƒŠãƒ¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</a
        >ã®ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆé–“éš”ã‚’éŸ³å£°ã§ç®¡ç†ã§ãã‚‹WEBã‚¢ãƒ—ãƒªã§ã™ã€‚
        2ç§’â†’1ç§’â†’2ç§’ã®éŸ³æ¥½ãŒæŒ‡å®šå›æ•°å†ç”Ÿã•ã‚Œã¾ã™ã€‚
        æŒ‡å®šå›æ•°å†ç”Ÿå¾Œã¯ã€æ­“å£°ãŒæµã‚Œã€çµµæ–‡å­—ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
        <br />
        This is a web application that allows you to manage your Convict
        Conditioning workout intervals with audio. Music of 2 seconds â†’ 1 second
        â†’ 2 seconds is played a specified number of times. After the specified
        number of playback, a cheer will be played and a pictogram will be
        displayed.
        <br />
        Author: <a href="https://shunyaueta.com/"> https://shunyaueta.com/</a>
        <br />
        Code:
        <a href="https://github.com/hurutoriya/convict-conditioning-rep-player"
          >https://github.com/hurutoriya/convict-conditioning-rep-player</a
        >
      </footer>
    </main>
    <script>
      const playbackForm = document.getElementById("playbackForm");
      const playbackCountInput = document.getElementById("playbackCount");
      const audioPlayer = document.getElementById("audioPlayer");
      const playCountElement = document.getElementById("playCount");
      const finishElement = document.getElementById("finish");

      // ãƒ•ã‚©ãƒ¼ãƒ ãŒé€ä¿¡ã•ã‚ŒãŸã¨ãã®å‡¦ç†
      playbackForm.addEventListener("submit", function (e) {
        e.preventDefault();

        const playbackCount = parseInt(playbackCountInput.value);

        if (isNaN(playbackCount) || playbackCount < 1) {
          alert("å†ç”Ÿå›æ•°ã¯1ä»¥ä¸Šã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
          return;
        }

        playAudio(playbackCount);
      });
      let playCount = 0;

      // éŸ³å£°ã‚’å†ç”Ÿã™ã‚‹é–¢æ•°
      function playAudio(playbackCount) {
        const audioPromise = audioPlayer.play();
        if (audioPromise !== undefined) {
          audioPromise
            .then(() => {
              // éŸ³å£°å†ç”Ÿå®Œäº†æ™‚ã®å‡¦ç†
              let remainingCount = playbackCount - 1;
              audioPlayer.addEventListener("ended", function playNext() {
                if (remainingCount > 0) {
                  audioPlayer.play();
                  remainingCount--;
                  playCount++;
                  playCountElement.textContent = playCount;
                } else {
                  audioPlayer.removeEventListener("ended", playNext);
                  playCount++;
                  playCountElement.textContent = playCount;
                  finishElement.textContent = "ğŸ‰ğŸ’ªğŸ‰";
                  audioPlayer.src = "data/applause.mp3";
                  audioPlayer.play();
                }
              });
            })
            .catch((error) => {
              console.error("éŸ³å£°å†ç”Ÿä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
            });
        }
      }
    </script>
  </body>
</html>
